(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{366:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("最近需要静态编译的 "),a("code",[s._v("libcurl.lib")]),s._v("，嵌入到我的 C++ 程序里面，但是好像发行版没有 "),a("code",[s._v(".lib")]),s._v(" 提供，只能自己编译了。")]),s._v(" "),a("p",[s._v("curl 的文档又多又杂，读起来挺麻烦的，很多时候不知道该到哪里找文档。")]),s._v(" "),a("h2",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),a("p",[s._v("首先到 "),a("a",{attrs:{href:"https://curl.se/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("curl 官网"),a("OutboundLink")],1),s._v(" 下载源代码 (Source Archives)，解压到任意位置。")]),s._v(" "),a("p",[s._v("然后打开 Visual Studio 的开发者命令提示符，有以下几种方法可以打开")]),s._v(" "),a("ul",[a("li",[s._v("使用 Windows Terminal（终端）打开")]),s._v(" "),a("li",[s._v("在 Visual Studio 的 "),a("code",[s._v("工具(T) -> 命令行(L) -> 开发者命令提示(C)")]),s._v(" 打开")]),s._v(" "),a("li",[s._v("打开文件 "),a("code",[s._v('"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\VsDevCmd.bat"')])])]),s._v(" "),a("p",[s._v("打开之后 cd 到解压的 curl 源码目录下的 "),a("code",[s._v("winbuild")]),s._v(" 目录，你也注意到这个目录下有个 "),a("code",[s._v("README.md")]),s._v(" 文件，这是在 Windows 下编译 curl 的帮助文档。")]),s._v(" "),a("p",[s._v("注意，"),a("strong",[s._v("使用开发者命令提示符")]),s._v("是很重要的一件事，否则你会找不到 "),a("code",[s._v("nmake")]),s._v(" 命令。")]),s._v(" "),a("h2",{attrs:{id:"编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[s._v("#")]),s._v(" 编译")]),s._v(" "),a("p",[s._v("在"),a("strong",[s._v("开发者命令提示符")]),s._v("执行以下命令即可编译 libcurl，注意一定要进入"),a("strong",[s._v("开发者命令提示符")]),s._v("！")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nmake /f Makefile.vc "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("static "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RTLIBCFG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("static "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VC")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MACHINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x64 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEBUG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("mode=static")]),s._v(" 相当于静态编译，生成 "),a("code",[s._v(".lib")]),s._v(" 文件；反之使用 "),a("code",[s._v("mode=dll")]),s._v(" 生成 "),a("code",[s._v(".dll")]),s._v(" 文件。")]),s._v(" "),a("li",[a("code",[s._v("RTLIBCFG=static")]),s._v(" 相当于链接时使用 "),a("code",[s._v("/MT")]),s._v(" 或 "),a("code",[s._v("/MTd")]),s._v(" 参数 (CRT 静态链接)。")]),s._v(" "),a("li",[a("code",[s._v("MACHINE")]),s._v(" 可选 "),a("code",[s._v("x64")]),s._v(","),a("code",[s._v("x86")]),s._v(","),a("code",[s._v("arm64")]),s._v("。"),a("code",[s._v("DEBUG")]),s._v(" 不解释。")])]),s._v(" "),a("p",[s._v("VC 版本与 Visual Studio 版本对应关系如下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Visual Studio 2008, VC=9\nVisual Studio 2010, VC=10\nVisual Studio 2012, VC=11\nVisual Studio 2013, VC=12\nVisual Studio 2014, VC=13\nVisual Studio 2015, VC=14\nVisual Studio 2017, VC=15\nVisual Studio 2019, VC=16\nVisual Studio 2022, VC=17\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("编译后的文件会出现在")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("builds/libcurl-vc17-x64-release-static-ipv6-sspi-schannel/lib/libcurl_a.lib\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("配置不相同，目录也不相同，总之都在 "),a("code",[s._v("builds")]),s._v(" 文件夹里。")]),s._v(" "),a("p",[s._v("如果需要添加 SSL 支持等等，请翻阅 "),a("code",[s._v("winbuild/README.md")]),s._v(" 说明文件，我不需要，就不另外研究了。")]),s._v(" "),a("h2",{attrs:{id:"在-visual-studio-导入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-visual-studio-导入依赖"}},[s._v("#")]),s._v(" 在 Visual Studio 导入依赖")]),s._v(" "),a("p",[s._v("假如编译目录在 "),a("code",[s._v("builds/libcurl-vc17-x64-release-static-ipv6-sspi-schannel/")])]),s._v(" "),a("p",[s._v("在项目属性进行如下编辑（添加目录不用那么死板，也可以将文件夹复制到项目目录再操作）")]),s._v(" "),a("ul",[a("li",[s._v("转到 "),a("code",[s._v("C/C++ -> 常规 -> 附加包含目录")]),s._v("，将编译目录中的 "),a("code",[s._v("include")]),s._v(" 目录添加进去。")]),s._v(" "),a("li",[s._v("转到 "),a("code",[s._v("C/C++ -> 预处理器 -> 预处理器定义")]),s._v("，添加一项 "),a("code",[s._v("CURL_STATICLIB")]),s._v("。")]),s._v(" "),a("li",[s._v("转到 "),a("code",[s._v("链接器 -> 常规 -> 附加库目录")]),s._v("，将编译目录中的 "),a("code",[s._v("lib")]),s._v(" 目录添加进去。")]),s._v(" "),a("li",[s._v("转到 "),a("code",[s._v("链接器 -> 输入 -> 附加依赖项")]),s._v("，添加一项 "),a("code",[s._v("libcurl_a.lib")]),s._v("。")]),s._v(" "),a("li",[s._v("转到 "),a("code",[s._v("链接器 -> 输入 -> 忽略特定默认库")]),s._v("，添加一项 "),a("code",[s._v("MSVCRT.lib")]),s._v("。")])]),s._v(" "),a("p",[s._v("然后你就可以愉快地使用 libcurl 啦")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/curl.h"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("pragma")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("comment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"libcurl_a.lib"')]),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  CURL"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" curl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  CURLcode res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl_global_init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CURL_GLOBAL_DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  curl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl_easy_init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl_easy_setopt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" CURLOPT_URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TODO: do what you want here.")]),s._v("\n    res "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl_easy_perform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl_easy_cleanup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl_global_cleanup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);