<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于实时接收PC微信消息的研究 | 人间工作P</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="从前人的研究入手，尝试实现读取微信接收消息">
    <meta name="keywords" content="个人技术博客,技术文档,人间工作P,人间工作,kotlin,java,csharp,c#,python,git,github,markdown">
    <meta name="baidu-site-verification" content="codeva-o8iMAsmwkT">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.1d5da9ac.css" as="style"><link rel="preload" href="/assets/js/app.8383ec1a.js" as="script"><link rel="preload" href="/assets/js/2.1586014b.js" as="script"><link rel="preload" href="/assets/js/20.7374822a.js" as="script"><link rel="prefetch" href="/assets/js/10.bcfbcf75.js"><link rel="prefetch" href="/assets/js/11.8f6efe05.js"><link rel="prefetch" href="/assets/js/12.f9f06bef.js"><link rel="prefetch" href="/assets/js/13.b54fa231.js"><link rel="prefetch" href="/assets/js/14.01d30ad3.js"><link rel="prefetch" href="/assets/js/15.a83ecc7f.js"><link rel="prefetch" href="/assets/js/16.1f5e94f3.js"><link rel="prefetch" href="/assets/js/17.9a097336.js"><link rel="prefetch" href="/assets/js/18.478f8662.js"><link rel="prefetch" href="/assets/js/19.3b0490a8.js"><link rel="prefetch" href="/assets/js/21.8b6fd980.js"><link rel="prefetch" href="/assets/js/3.83f1b7ad.js"><link rel="prefetch" href="/assets/js/4.29d7e6cf.js"><link rel="prefetch" href="/assets/js/5.2a3dbd37.js"><link rel="prefetch" href="/assets/js/6.410db86a.js"><link rel="prefetch" href="/assets/js/7.33cd613d.js"><link rel="prefetch" href="/assets/js/8.f417068c.js"><link rel="prefetch" href="/assets/js/9.246d437e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1d5da9ac.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="人间工作P" class="logo"> <span class="site-name can-hide">人间工作P</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.mrxiaom.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系列" class="dropdown-title"><!----> <span class="title" style="display:;">系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/?category=Bukkit%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B&amp;.html" class="nav-link">Bukkit开发教程</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/MrXiaoM/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://static.mcio.dev/mrxiaom.top/images/avatar-new.jpg"> <div class="blogger-info"><h3>人间工作P</h3> <span>我每天都好困… 最近在学习和进行 VOCALOID 创作</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="https://www.mrxiaom.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系列" class="dropdown-title"><!----> <span class="title" style="display:;">系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/?category=Bukkit%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B&amp;.html" class="nav-link">Bukkit开发教程</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/MrXiaoM/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>关于实时接收PC微信消息的研究</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/post/wechat-message-hook/#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/post/wechat-message-hook/#开始研究" class="sidebar-link">开始研究</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/post/wechat-message-hook/#原理解析" class="sidebar-link">原理解析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/post/wechat-message-hook/#静态分析" class="sidebar-link">静态分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/post/wechat-message-hook/#成果" class="sidebar-link">成果</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><!----> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.mrxiaom.top" target="_blank" title="作者" class="beLink" data-v-06225672>MrXiaoM</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-10-06</a></div> <div title="分类" class="date iconfont icon-wenjian" data-v-06225672><a href="/categories/?category=%E9%80%86%E5%90%91" data-v-06225672>逆向 </a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">关于实时接收PC微信消息的研究<!----></h1> <blockquote>
          从前人的研究入手，尝试实现读取微信接收消息
        </blockquote>  <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>我最近有读取自己的个人收款记录的需求，整理成 csv 表格，让程序对数据进行处理，实现生成报表、分析数据等等需求。</p> <p>奈何微信的「账单」功能还是太简单了，如果我想做，这得一个一个数据输入进去，太麻烦了。我有 24 小时运行的 Windows 服务器，于是就在想，能不能在服务器上登录我的微信小号，然后设置店员为我的小号，这样我的小号就能收到我的所有收款消息了。只要写一个 hook 读取就行了。</p> <h2 id="开始研究"><a href="#开始研究" class="header-anchor">#</a> 开始研究</h2> <p>由于我个人逆向经验很少，于是我决定先找几个前人做过的 Hook 研究看看。</p> <p>我研究的是开源的 <a href="https://github.com/lich0821/WeChatFerry" target="_blank" rel="noopener noreferrer">lich0821/WeChatFerry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。使用 win32 api 给微信进程挂载 dll，使用 MinHook 注入到<code>接收消息</code>部分，监听微信的消息接收。</p> <p>我首先做的是把项目拉下来，只留 WeChatFerry 文件夹里面的 Visual Studio 项目，并且把里面能砍的东西都砍了，只剩下 com（公共模块）、sdk（注入器）和 spy（挂载到微信的dll）。</p> <p>为什么我不直接使用 WeChatFerry 呢？首先，我并不需要这么多功能，我只需要一个<code>监听微信消息</code>就可以做到我需要的记账功能了。</p> <p>我花了几天的时间，大致研究明白微信 Hook 是如何工作的了。</p> <blockquote><p>免责声明: 本文仅为个人研究记录，仅供学习研究，请勿用于非法用途。</p></blockquote> <h2 id="原理解析"><a href="#原理解析" class="header-anchor">#</a> 原理解析</h2> <p>WeChatFerry 作者在他的<a href="https://mp.weixin.qq.com/s/CGLfSaNDy8MyuyPWGjGJ7w" target="_blank" rel="noopener noreferrer">微信公众号<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>发过原理，在此就不多表述，讲一点我自己的理解。</p> <p>我以前听说过 C/C++ 难写，现在上手之后，不是一般的难写。光是导入静态依赖就用了我很长时间，我想要的 curl 在 nuget 上没有，只能自己编译，编译之后出现了很多问题也只能自己解决。</p> <p>我把 sdk 改名为了 injector，它负责找到微信的进程，找不到时启动</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span> firstOpen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> status  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
DWORD wcPid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

status <span class="token operator">=</span> <span class="token function">GetDllPath</span><span class="token punctuation">(</span>debug<span class="token punctuation">,</span> spyDllPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">LOG_INFO</span><span class="token punctuation">(</span><span class="token string">&quot;[WxInitInject] 已找到 spy.dll 路径: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">Wstring2String</span><span class="token punctuation">(</span>spyDllPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
status <span class="token operator">=</span> <span class="token function">OpenWeChat</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wcPid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>firstOpen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">LOG_WARN</span><span class="token punctuation">(</span><span class="token string">&quot;[WxInitInject] 微信打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> L<span class="token string">&quot;打开微信失败&quot;</span><span class="token punctuation">,</span> L<span class="token string">&quot;WxInitSDK&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">LOG_INFO</span><span class="token punctuation">(</span><span class="token string">&quot;微信 PID: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">to_string</span><span class="token punctuation">(</span>wcPid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsProcessX64</span><span class="token punctuation">(</span>wcPid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">LOG_WARN</span><span class="token punctuation">(</span><span class="token string">&quot;[WxInitInject] 只支持 64 位微信&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> L<span class="token string">&quot;只支持 64 位微信&quot;</span><span class="token punctuation">,</span> L<span class="token string">&quot;WxInitSDK&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>firstOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">LOG_INFO</span><span class="token punctuation">(</span><span class="token string">&quot;[WxInitInject] 等待微信启动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>然后把 DLL 注入到微信，</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>wcProcess <span class="token operator">=</span> <span class="token function">InjectDll</span><span class="token punctuation">(</span>wcPid<span class="token punctuation">,</span> spyDllPath<span class="token punctuation">,</span> <span class="token operator">&amp;</span>spyBase<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>wcProcess <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">LOG_WARN</span><span class="token punctuation">(</span><span class="token string">&quot;[WxInitInject] 注入失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> L<span class="token string">&quot;注入失败&quot;</span><span class="token punctuation">,</span> L<span class="token string">&quot;WxInitSDK&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>并且调用其中的“注入主函数”，使用 MinHook 注入方法到指定的位置。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>PortPath_t pp <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
pp<span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>
<span class="token function">sprintf_s</span><span class="token punctuation">(</span>pp<span class="token punctuation">.</span>path<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">,</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>filesystem<span class="token double-colon punctuation">::</span><span class="token function">current_path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CallDllFuncEx</span><span class="token punctuation">(</span>wcProcess<span class="token punctuation">,</span> spyDllPath<span class="token punctuation">,</span> spyBase<span class="token punctuation">,</span> <span class="token string">&quot;InitSpy&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>pp<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PortPath_t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">LOG_WARN</span><span class="token punctuation">(</span><span class="token string">&quot;[WxInitInject] 初始化失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> L<span class="token string">&quot;初始化失败&quot;</span><span class="token punctuation">,</span> L<span class="token string">&quot;WxInitSDK&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">LOG_INFO</span><span class="token punctuation">(</span><span class="token string">&quot;注入完成!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>InitSpy 是 <code>spy.dll</code> 中的方法，它会初始化 logger，将它的日志输出到 injector 所在目录下的文件，检查微信版本是否支持，然后注入。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">InitSpy</span><span class="token punctuation">(</span>LPVOID args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">wchar_t</span> version<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    PortPath_t <span class="token operator">*</span>pp      <span class="token operator">=</span> <span class="token punctuation">(</span>PortPath_t <span class="token operator">*</span><span class="token punctuation">)</span>args<span class="token punctuation">;</span>
    string path <span class="token operator">=</span> pp<span class="token operator">-&gt;</span>path<span class="token punctuation">;</span>
    <span class="token function">InitLogger</span><span class="token punctuation">(</span><span class="token string">&quot;WCF&quot;</span><span class="token punctuation">,</span> path <span class="token operator">+</span> <span class="token string">&quot;/logs/wcf.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    g_WeChatWinDllAddr <span class="token operator">=</span> <span class="token punctuation">(</span>UINT64<span class="token punctuation">)</span><span class="token function">GetModuleHandle</span><span class="token punctuation">(</span>L<span class="token string">&quot;WeChatWin.dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取 WeChatWin 模块地址</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>g_WeChatWinDllAddr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOG_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;获取 WeChatWin.dll 模块地址失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// TODO: 退出进程，避免后面操作失败</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetWeChatVersion</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 获取微信版本</span>
        <span class="token function">LOG_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;获取微信版本失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">LOG_INFO</span><span class="token punctuation">(</span><span class="token string">&quot;WeChat version: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">Wstring2String</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsWxVersionMatched</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOG_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;不支持当前版本&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">ListenMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LOG_INFO</span><span class="token punctuation">(</span><span class="token string">&quot;注入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>上述的 <code>ListenMessage();</code> 是通过 MinHook 注入到微信指定位置的逻辑，在 <code>receive_msg.cpp</code> 中</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">ListenMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    MH_STATUS status <span class="token operator">=</span> MH_UNKNOWN<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>gIsListening<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOG_WARN</span><span class="token punctuation">(</span><span class="token string">&quot;gIsListening&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    funcRecvMsg <span class="token operator">=</span> <span class="token punctuation">(</span>RecvMsg_t<span class="token punctuation">)</span><span class="token punctuation">(</span>g_WeChatWinDllAddr <span class="token operator">+</span> OS_RECV_MSG_CALL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    status <span class="token operator">=</span> <span class="token function">InitializeHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOG_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;MH_Initialize failed: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">to_string</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    status <span class="token operator">=</span> <span class="token function">MH_CreateHook</span><span class="token punctuation">(</span>funcRecvMsg<span class="token punctuation">,</span> <span class="token operator">&amp;</span>DispatchMsg<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>LPVOID <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>realRecvMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOG_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;MH_CreateHook failed: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">to_string</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    status <span class="token operator">=</span> <span class="token function">MH_EnableHook</span><span class="token punctuation">(</span>funcRecvMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> MH_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOG_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;MH_EnableHook failed: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">to_string</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    gIsListening <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>注入到 WeChatWin.dll 地址相对的 <code>OS_RECV_MSG_CALL</code> 地址 (在 <code>receve_msg.cpp</code> 中规定了是 <code>0x2205510</code>)，<br>
初始化 Hook，新建 Hook，并启用 Hook。<br>
完成后，当微信接收到消息时，会转而去执行 <code>DispatchMsg</code> 函数，<br>
与 WeChatFerry 一样，在这个函数的结尾会执行 <code>realRecvMsg</code> 函数，即微信原本的接收消息函数，以维持微信正常运行。</p> <p>原理就是这么个原理，难点在于如何定位“接收消息”函数在哪里。</p> <h2 id="静态分析"><a href="#静态分析" class="header-anchor">#</a> 静态分析</h2> <p>正如上文所说的，我个人逆向经验很少，以下是按照 WeChatFerry 中提供的地址进行定位找特征的。WeChatFerry 基于微信 3.9.10.27 开发，所以这里我们先射箭后画靶分析一波该如何找到这个函数的特征。</p> <p>让我们打开 ida，对 <code>WeChatWin.dll</code> 进行完整分析（大概需要几小时）。</p> <p>先“搜索”一遍“文本” <code>AppMsgMgr::OnSyncAppMsgAdd</code>（查找所有事件），等待搜索结果出来，让东西都加载得差不多。</p> <p>然后“转跳”，“转跳到名称” <code>aAppmsgmgrOnsyn</code>，也就是字符串 <code>&quot;AppMsgMgr::OnSyncAppMsgAdd&quot;</code> 的常量默认名称，</p> <p><img src="https://pic.imgdb.cn/item/67024ffed29ded1a8c132760.png" alt=""></p> <p>右键它，点击“交叉引用列表”，有两个结果，</p> <p><img src="https://pic.imgdb.cn/item/67025091d29ded1a8c13aa69.png" alt=""></p> <p>两个是在同一个函数里的，任选一个点进它所在的函数，往上翻到函数名为止（这里是 <code>sub_18219AEB0</code>），然后右键这个函数，点击“交叉引用列表”，里面只有一个结果，<br>
点进去，就是接收消息的函数了。</p> <p><img src="https://pic.imgdb.cn/item/67025118d29ded1a8c141727.png" alt=""></p> <p>按 F5 生成伪代码，往下翻，在函数开头往下一点点的地方能找到字符串 <code>&quot;notifymessage&quot;</code>，以及它下面有一行 <code>某某 = 13;</code> 或 <code>某某 = 13i64;</code> 就代表找对了。</p> <p><img src="https://pic.imgdb.cn/item/670251c0d29ded1a8c14ead5.png" alt=""></p> <p>函数名一般包含了地址，格式为 <code>sub_地址</code>，这里是 <code>sub_182205510</code>。还要减去文件开头 HEADER 地址 <code>0000000180000000</code> 才是这个函数的地址，也就是 <code>0x2205510</code> 了。</p> <p>定位到函数还不够，还要定位各个参数的相对地址，不然只能监听，不能读取，没什么用。</p> <p>首先我们要找到基址是哪个参数，如上图有两个参数，而旧版本微信只有一个参数。鼠标点击它，点击哪个，开头的 if 及附近有变量高亮了，它就是基址。先右键，<code>Rename lvar</code> 将它改名为 <code>baseAddress</code> 记一下。</p> <p>接下来，看看这个 <code>baseAddress</code> 都用在哪了，跟它有加减关系的常数全部都右键，点击 <code>Hexadecimal</code> 将它们转换为十六进制以便之后使用。如果它作为函数参数传进其它函数里面了，也要点进那个函数，将相应参数改名为 <code>baseAddress</code>，重复上述操作。</p> <p>根据 WeChatFerry 给出的点位，在相应地址附近写注释，大概就如下图所示。</p> <p><img src="https://pic.imgdb.cn/item/67025e18d29ded1a8c1fff40.png" alt=""></p> <p>(参数接入点2的注释应该是 <code>altAddress = bassAddress + 0x1C0</code>，改图麻烦，就懒得改了)</p> <p>我们假设新版本微信没做多少变更，用上面的方法，反汇编分析本文完成时最新版微信 (3.9.12.17) 的 <code>WeChatWin.dll</code>，来到这个函数，看看有什么对的上的。</p> <p>经过比对，微信 3.9.12.17 只有接收消息函数变成了 <code>sub_182141E80</code>，即地址 <code>0x2141E80</code>，参数的相对地址没有改变，如需升级到这个版本，只需要改 Hook 函数地址即可。</p> <h2 id="成果"><a href="#成果" class="header-anchor">#</a> 成果</h2> <p>最终修改完成的 Hook 发布在我的 Github: <a href="https://github.com/MrXiaoM/WeChatMessages" target="_blank" rel="noopener noreferrer">MrXiaoM/WeChatMessages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>原本 WeChatFerry 的 rpc 我扬了，用不惯 proto，改成了序列化成 json 后用 libcurl 向某个地址发 http post，更符合我自己的风格。</p> <p><img src="https://pic.imgdb.cn/item/67028e7ad29ded1a8c4dc63b.png" alt=""></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/MrXiaoM/blog/edit/main/docs/_posts/wechat-message-hook.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E5%BE%AE%E4%BF%A1" title="标签">#微信</a><a href="/tags/?tag=WeChat" title="标签">#WeChat</a><a href="/tags/?tag=Hook" title="标签">#Hook</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/06, 21:30:59</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/bukkit/get-started/"><div>
            Bukkit开发教程/入门指南
            <!----></div></a> <span class="date">01-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/post/mc-cyber-security/"><div>
            关于 Minecraft 服务器安全防护建议
            <!----></div></a> <span class="date">01-13</span></dt></dl><dl><dd>03</dd> <dt><a href="/inst/"><div>
            互联网实例
            <!----></div></a> <span class="date"></span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer">
  Theme fork from
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2025
    <span><a href="https://www.mrxiaom.top">人间工作P</a> | <a href="/friends">友情链接</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8383ec1a.js" defer></script><script src="/assets/js/2.1586014b.js" defer></script><script src="/assets/js/20.7374822a.js" defer></script>
  </body>
</html>
